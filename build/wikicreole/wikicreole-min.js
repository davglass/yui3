YUI.add("wikicreole",function(e,t){var n=function(e){n.superclass.constructor.apply(this,arguments)},r=e.Lang,i=e.UA,s="escaped",o="\n",u=/^h([1-6])$/i,a=/(\r?\n\s*)$/,f=/\r?\n/g,l=/[^\t\n\r ]/,c=/^(?:\/|https?|ftp):\/\//i,h=/(\}\})|(\}$)/g,p="",d="=",v="\\\\",m="|",g=" ",y="~",b="**",w="//",E="li",S="ol",x="#",T="p",N="pre",C="tt",k="ul",L="*";e.extend(n,e.Plugin.Base,{initializer:function(){this.afterHostMethod("getContent",this._convert,this)},_appendNewLines:function(e){var t=0,n=this._endResult,r=a.exec(n.slice(-2).join(p));r&&(t=r[1].length);while(t++<e)n.push(o)},_convert:function(){var t=e.Do.originalRetVal,n=document.createElement("div"),r;return n.innerHTML=t,this._handle(n),r=this._endResult.join(p),this._endResult=null,this._listsStack.length=0,new e.Do.AlterReturn(null,r)},_handle:function(e){var t,n,r,i,s,o,u,a,f;this._endResult||(this._endResult=[]),n=e.childNodes,i=n.length,u=this._pushTagList;for(r=0;r<i;r++){s=[],o=[],a=[],f=[],t=n[r];if(this._isIgnorable(t)&&!this._skipParse)continue;this._handleElementStart(t,s,o),this._handleStyles(t,a,f),u.call(this,s),u.call(this,a),this._handle(t),this._handleElementEnd(t,s,o),u.call(this,f.reverse()),u.call(this,o)}this._handleData(e.data,e)},_handleBreak:function(e,t,n){var r=v;this._skipParse&&(r=o),t.push(r)},_handleData:function(e,t){e&&(this._skipParse||(e=e.replace(f,p)),this._endResult.push(e))},_handleElementEnd:function(e,t,n){var r=e.tagName;r&&(r=r.toLowerCase());if(r===T)this._isLastItemNewLine()||this._endResult.push(o);else if(r===k||r===S){this._listsStack.pop();var i=1;this._hasParentNode(e,E)||(i=2),this._appendNewLines(i)}else r===N?(this._isLastItemNewLine()||this._endResult.push(o),this._skipParse=!1):r===C?this._skipParse=!1:r==="table"&&n.push(o)},_handleElementStart:function(e,t,n){var r,i=e.tagName;i&&(i=i.toLowerCase(),i===T?this._handleParagraph(e,t,n):i==="br"?this._handleBreak(e,t,n):i==="a"?this._handleLink(e,t,n):i==="span"?this._handleSpan(e,t,n):i==="strong"||i==="b"?this._handleStrong(e,t,n):i==="em"||i==="i"?this._handleEm(e,t,n):i==="img"?this._handleImage(e,t,n):i===k?this._handleUnorderedList(e,t,n):i===E?this._handleListItem(e,t,n):i===S?this._handleOrderedList(e,t,n):i==="hr"?this._handleHr(e,t,n):i===N?this._handlePre(e,t,n):i===C?this._handleTT(e,t,n):(r=u.exec(i))?this._handleHeading(e,t,n,r):i==="th"?this._handleTableHeader(e,t,n):i==="tr"?this._handleTableRow(e,t,n):i==="td"&&this._handleTableCell(e,t,n))},_handleEm:function(e,t,n){t.push(w),n.push(w)},_handleHeading:function(e,t,n,r){var i=new Array(parseInt(r[1],10)+1);i=i.join(d),this._isDataAvailable()&&!this._isLastItemNewLine()&&t.push(o),t.push(i,g),n.push(g,i,o)},_handleHr:function(e,t,n){this._isDataAvailable()&&!this._isLastItemNewLine()&&t.push(o),t.push("----",o)},_handleImage:function(e,t,n){var r=e.getAttribute("alt"),i=e.getAttribute("src");i=i.replace(this.get("ignoreImgPrefix"),p),t.push("{{",i),r&&(r=r.replace(h,function(e,t,n,r,i){var s;return t?s="}~}":n&&(s="~}"),s}),t.push(m,r)),n.push("}}")},_handleLink:function(e,t,n){var r,s,o,u;s=e.getAttribute("href"),i.ie<=8&&(o=window.location,u=o.protocol+"//"+o.host+o.pathname,u=u.substr(0,u.lastIndexOf("/")+1),r=s.indexOf(u),r===0&&(s=s.substr(u.length))),c.test(s)||(s=decodeURIComponent(s)),t.push("[[",s,m),n.push("]]")},_handleListItem:function(e,t,n){var r,i;this._isDataAvailable()&&!this._isLastItemNewLine()&&t.push(o),r=this._listsStack,i=r.length,t.push((new Array(i+1)).join(r[i-1]))},_handleOrderedList:function(e,t,n){this._listsStack.push(x)},_handleParagraph:function(e,t,n){this._isDataAvailable()&&this._appendNewLines(2),n.push(o)},_handlePre:function(e,t,n){var r;this._skipParse=!0,r=this._endResult,this._isDataAvailable()&&!this._isLastItemNewLine()&&r.push(o),t.push("{{{",o),n.push("}}}",o)},_handleSpan:function(e,t,n){this._hasClass(e,s)&&t.push(y)},_handleStrong:function(e,t,n){this._isParentNode(e,E)&&(!e.previousSibling||this._isIgnorable(e.previousSibling))&&t.push(g),t.push(b),n.push(b)},_handleStyles:function(e,t,n){var r=e.style;r&&(r.fontWeight.toLowerCase()==="bold"&&(t.push(b),n.push(b)),r.fontStyle.toLowerCase()==="italic"&&(t.push(w),n.push(w)))},_handleTableCell:function(e,t,n){t.push(m)},_handleTableHeader:function(e,t,n){t.push(m,d)},_handleTableRow:function(e,t,n){this._isDataAvailable()&&t.push(o),n.push(m)},_handleTT:function(e,t,n){this._skipParse=!0,t.push("{{{"),n.push("}}}")},_handleUnorderedList:function(e,t,n){this._listsStack.push(L)},_hasClass:function(e,t){return(g+e.className+g).indexOf(g+t+g)>-1},_hasParentNode:function(e,t,n){var i,s,o,u,a;r.isArray(t)||(t=[t]),u=!1,o=e.parentNode,a=o&&o.tagName&&o.tagName.toLowerCase();if(a)for(i=0,s=t.length;i<s;i++){u=this._tagNameMatch(a,t[i]);if(u)break}return!u&&o&&(!isFinite(n)||--n)&&(u=this._hasParentNode(o,t,n)),u},_isDataAvailable:function(){return this._endResult&&this._endResult.length},_isIgnorable:function(e){var t=e.nodeType;return e.isElementContentWhitespace||t===8||t===3&&this._isWhitespace(e)},_isLastItemNewLine:function(e){var t=this._endResult;return t&&a.test(t.slice(-1))},_isParentNode:function(e,t){return this._hasParentNode(e,t,1)},_isWhitespace:function(e){return e.isElementContentWhitespace||!l.test(e.data)},_pushTagList:function(e){var t,n,r,i;t=this._endResult,r=e.length;for(n=0;n<r;n++)i=e[n],t.push(i)},_tagNameMatch:function(e,t){return t instanceof RegExp&&t.test(e)||e===t},_endResult:null,_listsStack:[],_skipParse:!1},{NAME:"wikicreole",NS:"wikicreole",ATTRS:{ignoreImgPrefix:{value:p}}}),e.namespace("Plugin"),e.Plugin.WikiCreole=n},"@VERSION@",{requires:["editor-para","event-custom-base","plugin"]});
